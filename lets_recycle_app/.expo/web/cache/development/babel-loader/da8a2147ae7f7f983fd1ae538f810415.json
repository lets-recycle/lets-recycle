{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport AsyncStorage from \"react-native-web/dist/exports/AsyncStorage\";\nimport createDataContext from \"./createDataContext\";\nimport { navigate } from \"../navigationRef\";\nimport firebase from 'firebase';\nvar API = 'https://lets-recycle-67594.firebaseio.com';\n\nvar authReducer = function authReducer(state, action) {\n  switch (action.type) {\n    case 'add_error':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: action.payload\n      });\n\n    case 'signin':\n      return {\n        errorMessage: '',\n        user: action.payload\n      };\n\n    case 'clear_error_message':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: ''\n      });\n\n    case 'signout':\n      return {\n        user: null,\n        errorMessage: ''\n      };\n\n    case 'addToUser':\n      return {\n        user: _objectSpread(_objectSpread({}, state.user), action.payload),\n        errorMessage: ''\n      };\n\n    default:\n      return state;\n  }\n};\n\nvar tryLocalSignin = function tryLocalSignin(dispatch) {\n  return function _callee2() {\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(firebase.auth().currentUser);\n\n          case 2:\n            user = _context2.sent;\n\n            if (user) {\n              dispatch({\n                type: 'signin',\n                payload: user\n              });\n\n              (function _callee() {\n                var results, res;\n                return _regeneratorRuntime.async(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.next = 2;\n                        return _regeneratorRuntime.awrap(fetch(API + \"/users.json?orderBy=\\\"id\\\"&equalTo=\\\"\" + user.uid + \"\\\"\", {\n                          method: 'GET',\n                          mode: 'cors',\n                          headers: new Headers({\n                            'Content-Type': 'application/json',\n                            'Accept': 'application/json'\n                          })\n                        }));\n\n                      case 2:\n                        results = _context.sent;\n                        _context.next = 5;\n                        return _regeneratorRuntime.awrap(results.json());\n\n                      case 5:\n                        res = _context.sent;\n                        dispatch({\n                          type: 'addToUser',\n                          payload: res[Object.keys(res)[0]]\n                        });\n\n                      case 7:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              })();\n            } else {\n              navigate('Signup');\n            }\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar clearErrorMessage = function clearErrorMessage(dispatch) {\n  return function () {\n    dispatch({\n      type: 'clear_error_message'\n    });\n  };\n};\n\nvar signup = function signup(dispatch) {\n  return function _callee4(_ref) {\n    var email, password;\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            email = _ref.email, password = _ref.password;\n            _context4.prev = 1;\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(firebase.auth().createUserWithEmailAndPassword(email, password).then(function () {\n              var user = firebase.auth().currentUser;\n              dispatch({\n                type: 'signin',\n                payload: firebase.auth().currentUser\n              });\n\n              (function _callee3() {\n                return _regeneratorRuntime.async(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        _context3.next = 2;\n                        return _regeneratorRuntime.awrap(fetch(API + \"/users.json\", {\n                          method: 'POST',\n                          mode: 'cors',\n                          headers: new Headers({\n                            'Content-Type': 'application/json',\n                            'Accept': 'application/json'\n                          }),\n                          body: JSON.stringify({\n                            \"id\": user.uid,\n                            \"location\": \" no location\",\n                            \"balance\": '0',\n                            \"phoneNumber\": 'no number'\n                          })\n                        }));\n\n                      case 2:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              })();\n\n              navigate('Home');\n            }).catch(function (error) {\n              console.log(error[0]);\n              console.log(\"fail\");\n              dispatch({\n                type: 'add_error',\n                payload: error[0]\n              });\n            }));\n\n          case 4:\n            _context4.next = 10;\n            break;\n\n          case 6:\n            _context4.prev = 6;\n            _context4.t0 = _context4[\"catch\"](1);\n            console.log(_context4.t0);\n            dispatch({\n              type: 'add_error',\n              payload: 'Something went wrong with sign up'\n            });\n\n          case 10:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[1, 6]], Promise);\n  };\n};\n\nvar signin = function signin(dispatch) {\n  return function _callee7(_ref2) {\n    var email, password;\n    return _regeneratorRuntime.async(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            email = _ref2.email, password = _ref2.password;\n            _context7.prev = 1;\n            _context7.next = 4;\n            return _regeneratorRuntime.awrap(firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function _callee6() {\n              var user;\n              return _regeneratorRuntime.async(function _callee6$(_context6) {\n                while (1) {\n                  switch (_context6.prev = _context6.next) {\n                    case 0:\n                      _context6.next = 2;\n                      return _regeneratorRuntime.awrap(firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {\n                        console.log(\"fail\");\n                        dispatch({\n                          type: 'add_error',\n                          payload: 'Something went wrong with sign in'\n                        });\n                      }));\n\n                    case 2:\n                      user = firebase.auth().currentUser;\n                      dispatch({\n                        type: 'signin',\n                        payload: firebase.auth().currentUser\n                      });\n\n                      (function _callee5() {\n                        var results, res;\n                        return _regeneratorRuntime.async(function _callee5$(_context5) {\n                          while (1) {\n                            switch (_context5.prev = _context5.next) {\n                              case 0:\n                                _context5.next = 2;\n                                return _regeneratorRuntime.awrap(fetch(API + \"/users.json?orderBy=\\\"id\\\"&equalTo=\\\"\" + user.uid + \"\\\"\", {\n                                  method: 'GET',\n                                  mode: 'cors',\n                                  headers: new Headers({\n                                    'Content-Type': 'application/json',\n                                    'Accept': 'application/json'\n                                  })\n                                }));\n\n                              case 2:\n                                results = _context5.sent;\n                                _context5.next = 5;\n                                return _regeneratorRuntime.awrap(results.json());\n\n                              case 5:\n                                res = _context5.sent;\n                                dispatch({\n                                  type: 'addToUser',\n                                  payload: res[Object.keys(res)[0]]\n                                });\n\n                              case 7:\n                              case \"end\":\n                                return _context5.stop();\n                            }\n                          }\n                        }, null, null, null, Promise);\n                      })();\n\n                    case 5:\n                    case \"end\":\n                      return _context6.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            }).catch(function (error) {\n              var errorCode = error.code;\n              var errorMessage = error.message;\n            }));\n\n          case 4:\n            navigate('Home');\n            _context7.next = 10;\n            break;\n\n          case 7:\n            _context7.prev = 7;\n            _context7.t0 = _context7[\"catch\"](1);\n            dispatch({\n              type: 'add_error',\n              payload: 'Something went wrong with sign in'\n            });\n\n          case 10:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, null, null, [[1, 7]], Promise);\n  };\n};\n\nvar signout = function signout(dispatch) {\n  return function _callee8() {\n    return _regeneratorRuntime.async(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            dispatch({\n              type: 'signout'\n            });\n            navigate('loginFlow');\n\n          case 2:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar update = function update(dispatch) {\n  return function _callee10(obj) {\n    var user;\n    return _regeneratorRuntime.async(function _callee10$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            console.log(\"obj---------->\", obj);\n            user = firebase.auth().currentUser;\n            _context10.next = 4;\n            return _regeneratorRuntime.awrap(user.updateProfile(_objectSpread(_objectSpread({}, user), obj)).then(function () {\n              (function _callee9() {\n                var results, res;\n                return _regeneratorRuntime.async(function _callee9$(_context9) {\n                  while (1) {\n                    switch (_context9.prev = _context9.next) {\n                      case 0:\n                        _context9.next = 2;\n                        return _regeneratorRuntime.awrap(fetch(API + \"/users.json?orderBy=\\\"id\\\"&equalTo=\\\"\" + user.uid + \"\\\"\", {\n                          method: 'GET',\n                          mode: 'cors',\n                          headers: new Headers({\n                            'Content-Type': 'application/json',\n                            'Accept': 'application/json'\n                          })\n                        }));\n\n                      case 2:\n                        results = _context9.sent;\n                        _context9.next = 5;\n                        return _regeneratorRuntime.awrap(results.json());\n\n                      case 5:\n                        res = _context9.sent;\n                        console.log(_objectSpread(_objectSpread({}, res[Object.keys(res)[0]]), obj), 'pppppppppppppppppp');\n                        _context9.next = 9;\n                        return _regeneratorRuntime.awrap(fetch(API + \"/users/\" + Object.keys(res)[0] + \".json\", {\n                          method: 'PUT',\n                          mode: 'cors',\n                          headers: new Headers({\n                            'Content-Type': 'application/json',\n                            'Accept': 'application/json'\n                          }),\n                          body: JSON.stringify(_objectSpread(_objectSpread({}, res[Object.keys(res)[0]]), obj))\n                        }));\n\n                      case 9:\n                        dispatch({\n                          type: 'addToUser',\n                          payload: _objectSpread(_objectSpread({}, res[Object.keys(res)[0]]), obj)\n                        });\n\n                      case 10:\n                      case \"end\":\n                        return _context9.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              })();\n\n              navigate('Profile');\n            }).catch(function (error) {\n              console.log('eeeeeeeeeee', error);\n            }));\n\n          case 4:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar _createDataContext = createDataContext(authReducer, {\n  signin: signin,\n  signout: signout,\n  signup: signup,\n  clearErrorMessage: clearErrorMessage,\n  tryLocalSignin: tryLocalSignin,\n  update: update\n}, {\n  user: null,\n  errorMessage: ''\n}),\n    Provider = _createDataContext.Provider,\n    Context = _createDataContext.Context;\n\nexport { Provider, Context };","map":{"version":3,"sources":["/mnt/c/Users/STD/Desktop/lets_recycle/lets_recycle/lets_recycle_app/src/context/AuthContext.js"],"names":["createDataContext","navigate","firebase","API","authReducer","state","action","type","errorMessage","payload","user","tryLocalSignin","dispatch","auth","currentUser","fetch","uid","method","mode","headers","Headers","results","json","res","Object","keys","clearErrorMessage","signup","email","password","createUserWithEmailAndPassword","then","body","JSON","stringify","catch","error","console","log","signin","setPersistence","Auth","Persistence","LOCAL","signInWithEmailAndPassword","errorCode","code","message","signout","update","obj","updateProfile","Provider","Context"],"mappings":"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","sourcesContent":["import { AsyncStorage } from 'react-native';\nimport createDataContext from './createDataContext';\nimport { navigate } from '../navigationRef';\nimport firebase from 'firebase';\n\nconst API = 'https://lets-recycle-67594.firebaseio.com'\n\nconst authReducer = (state, action) => {\n  switch (action.type) {\n    case 'add_error':\n      return { ...state, errorMessage: action.payload };\n    case 'signin':\n      return { errorMessage: '', user: action.payload };\n    case 'clear_error_message':\n      return { ...state, errorMessage: '' };\n    case 'signout':\n      return { user: null, errorMessage: '' };\n    case 'addToUser':\n      return { user: { ...state.user, ...action.payload }, errorMessage: '' };\n    default:\n      return state;\n  }\n};\n\nconst tryLocalSignin = dispatch => async () => {\n  // const token = await AsyncStorage.getItem('token');\n  user = await firebase.auth().currentUser\n  if (user) {\n    dispatch({ type: 'signin', payload: user });\n    (async () => {\n      let results = await fetch(`${API}/users.json?orderBy=\"id\"&equalTo=\"${user.uid}\"`, {\n        method: 'GET',\n        mode: 'cors',\n        headers: new Headers({\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        }),\n      });\n      let res = await results.json();\n      dispatch({ type: 'addToUser', payload: res[Object.keys(res)[0]] });\n\n    })();\n  } else {\n    navigate('Signup');\n  }\n};\n\nconst clearErrorMessage = dispatch => () => {\n  dispatch({ type: 'clear_error_message' });\n};\n\nconst signup = dispatch => async ({ email, password }) => {\n  try {\n    await firebase.auth().createUserWithEmailAndPassword(email, password).then(() => {\n\n      let user = firebase.auth().currentUser;\n      dispatch({ type: 'signin', payload: firebase.auth().currentUser });\n      (async () => {\n        await fetch(`${API}/users.json`, {\n          method: 'POST',\n          mode: 'cors',\n          headers: new Headers({\n            'Content-Type': 'application/json',\n            'Accept': 'application/json'\n          }),\n          body: JSON.stringify({\n            \"id\": user.uid,\n            \"location\": \" no location\",\n            \"balance\": '0',\n            \"phoneNumber\": 'no number',\n          })\n        });\n      })();\n\n      navigate('Home');\n\n    }).catch(function (error) {\n      console.log(error[0])\n      console.log(\"fail\");\n      dispatch({\n        type: 'add_error',\n        payload: error[0]\n      });\n    });\n    // console.log(\"token\", firebase.auth().currentUser);\n\n  } catch (err) {\n    console.log(err)\n    dispatch({\n      type: 'add_error',\n      payload: 'Something went wrong with sign up'\n    });\n  }\n};\n\nconst signin = dispatch => async ({ email, password }) => {\n  try {\n    await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)\n      .then(async function () {\n        // Existing and future Auth states are now persisted in the current\n        // session only. Closing the window would clear any existing state even\n        // if a user forgets to sign out.\n        // ...\n        // New sign-in will be persisted with session persistence.\n        await firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {\n          console.log(\"fail\");\n          dispatch({\n            type: 'add_error',\n            payload: 'Something went wrong with sign in'\n          });\n        });\n        // console.log(\"done\");\n        // console.log(\"token\", firebase.auth().currentUser)\n        let user = firebase.auth().currentUser;\n        dispatch({ type: 'signin', payload: firebase.auth().currentUser });\n        (async () => {\n          let results = await fetch(`${API}/users.json?orderBy=\"id\"&equalTo=\"${user.uid}\"`, {\n            method: 'GET',\n            mode: 'cors',\n            headers: new Headers({\n              'Content-Type': 'application/json',\n              'Accept': 'application/json'\n            }),\n          });\n          let res = await results.json();\n          dispatch({ type: 'addToUser', payload: res[Object.keys(res)[0]] });\n\n        })();\n      })\n      .catch(function (error) {\n        // Handle Errors here.\n        var errorCode = error.code;\n        var errorMessage = error.message;\n      });\n    navigate('Home');\n  } catch (err) {\n    dispatch({\n      type: 'add_error',\n      payload: 'Something went wrong with sign in'\n    });\n  }\n};\n\nconst signout = dispatch => async () => {\n  // await AsyncStorage.removeItem('token');\n  dispatch({ type: 'signout' });\n  navigate('loginFlow');\n};\n\nconst update = dispatch => async (obj) => {\n  // await AsyncStorage.removeItem('token');\n  console.log(\"obj---------->\", obj)\n  var user = firebase.auth().currentUser;\n\n  await user.updateProfile({ ...user, ...obj }).then(function () {\n    // Update successful.\n    (async () => {\n      let results = await fetch(`${API}/users.json?orderBy=\"id\"&equalTo=\"${user.uid}\"`, {\n        method: 'GET',\n        mode: 'cors',\n        headers: new Headers({\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        }),\n      });\n      let res = await results.json();\n      console.log({ ...res[Object.keys(res)[0]], ...obj }, 'pppppppppppppppppp');\n      await fetch(`${API}/users/${Object.keys(res)[0]}.json`, {\n        method: 'PUT',\n        mode: 'cors',\n        headers: new Headers({\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        }),\n        body: JSON.stringify({ ...res[Object.keys(res)[0]], ...obj })\n      });\n      dispatch({ type: 'addToUser', payload: { ...res[Object.keys(res)[0]], ...obj } });\n    })();\n\n    navigate('Profile');\n  }).catch(function (error) {\n    // An error happened.\n    console.log('eeeeeeeeeee', error);\n  });\n\n};\n\nexport const { Provider, Context } = createDataContext(\n  authReducer,\n  { signin, signout, signup, clearErrorMessage, tryLocalSignin, update },\n  { user: null, errorMessage: '' }\n);\n"]},"metadata":{},"sourceType":"module"}